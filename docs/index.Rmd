---
title: "Tidy data and statistical visualisation <br> to support exploration of temporal data"
type: "Workshop"
author: "Earo Wang"
date: "May 29, 2017 <br> <br> Slides on http://bit.ly/tsvis17"
output:
  xaringan::moon_reader:
    css: ["default", "myremark.css"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r initial, echo = FALSE, cache = FALSE, results = 'hide'}
library(knitr)
options(htmltools.dir.version = FALSE, tibble.width = 60)
opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = 'figure/', cache.path = 'cache/', fig.align = 'center', 
  fig.width = 12, fig.height = 9, fig.show = 'hold', 
  cache = TRUE, external = TRUE, dev = 'CairoPNG', dpi = 300
)
read_chunk('src/code.R')
```

## Bio

---

## Agenda

* Tidy temporal data
    + `ts` class vs `tibble` class
* What does `gg` in `ggplot2` stand for? A grammar of graphics
* How do we know if what we see really is there? Visual statistical inference
* Calendar-based view for visualising people's daily schedules
* Interactive data visualisation on the web
    + `plotly::ggplotly()`
    + Shiny

```{r load-library}
```

```{r theme-remark}
```
---

class: inverse middle center

# Tidy temporal data and data wrangling

---

class: middle

## What is tidy data?

* Each variable forms a column.
* Each observation forms a row.
* Each type of observational unit forms a table.

---

.left-column[
## Melbourne pedestrian data .red[*]
### - sensor data
]
.right-column[

```{r ped-loc, echo = TRUE}
```

.footnote[.red[*] source: [the city of Melbourne](http://www.pedestrian.melbourne.vic.gov.au)]
]

---

.left-column[
## Melbourne pedestrian data .red[*]
### - sensor data
### - sensor map
]
.right-column[

```{r ped-map}
```
]

---

.left-column[
## Melbourne pedestrian data .red[*]
### - sensor data
### - sensor map
### - hourly counts
]
.right-column[

```{r ped-wide, echo = TRUE}
```
]

---

.left-column[
## Melbourne pedestrian data .red[*]
### - sensor data
### - sensor map
### - hourly counts
### - `autoplot`
]
.right-column[

```{r ped-ts-show, echo = TRUE, eval = FALSE}
ped_ts <- ts(ped_2017[, -c(1, 2)], frequency = 24)
sub_ped_ts <- ped_ts[, sample(ncol(ped_ts), 5)]
autoplot(sub_ped_ts, facet = TRUE)
```

```{r ped-ts, fig.height = 10}
```
]

---

.left-column[
## Melbourne pedestrian data .red[*]
### - sensor data
### - sensor map
### - hourly counts
### - `autoplot`
### - issues?
]
.right-column[
From the tidy data in the wide format,

* how to join the pedestrian sensor locations by the sensor names?
* how to retrieve the temporal components and plot the sub-series b/t weekdays
  & weekends?
]

---

.left-column[
## Melbourne pedestrian data .red[*]
### - sensor data
### - sensor map
### - hourly counts
### - `autoplot`
### - issues?
### - tidy data
]
.right-column[

```{r ped-long, echo = TRUE}
```

p.s. `tidyr::spread` makes it easy to switch "long" back to "wide":

```{r ped-spread, echo = TRUE, eval = FALSE}
ped_long %>%
  spread(Sensor_Name, Counts)
```

]

---

.left-column[
## Otway weather data .red[*]
### - what variables?
]
.right-column[
```{r otway-weather, echo = TRUE}
```
.footnote[.red[*] source: [global historical climatology network](https://www1.ncdc.noaa.gov/pub/data/ghcn/daily/gsn/)]
]

---

.left-column[
## Otway weather data .red[*]
### - what variables?
### - tidying
]
.right-column[
```{r otway-tidy-1, echo = TRUE}
```
]

---

.left-column[
## Otway weather data .red[*]
### - what variables?
### - tidying
]
.right-column[
```{r otway-tidy-2, echo = TRUE}
```
]

---

.left-column[
## Otway weather data .red[*]
### - what variables?
### - tidying
]
.right-column[
```{r otway-tidy-3, echo = TRUE}
```
]

---

.left-column[
## Otway weather data .red[*]
### - what variables?
### - tidying
]
.right-column[
```{r otway-tidy, echo = TRUE}
```
]

---

class: inverse middle center

# A grammar of graphics

---

class: middle

## What is a grammar of graphics?

* A conceptual framework for mapping data to graphical form
* The analogue of doing a functional mapping of random variables. For example,
  $n$ independent and identically distributed RVs $X_1, \ldots, X_n$, the mean
  is defined as 
  $$\bar{X} = \frac{1}{n} \sum_{i = 1}^{n} X_{i}.$$

---

.left-column[
## More on pedestrian data
### - `ggplot2`
]
.right-column[

```
data: ped_long
layer:
    mapping: x = Date_Time, y = Counts
    geom: line
facet: Sensor_Name
```

```{r ped-ggplot-1}
```
]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
]
.right-column[

```
data: ped_long
layer:
    mapping: x = Date_Time, y = Counts, colour = Sensor_Name
    geom: line
facet: Sensor_Name
```

```{r ped-ggplot-2}
```

]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
### - Southern X
]
.right-column[

```{r southern-x, echo = TRUE}
```

]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
### - Southern X
]
.right-column[

```
data: southern-cross
layer:
    mapping: x = Hour, y = Counts, colour = Wday
    geom: line
```

```{r x-colour, fig.height = 7}
```

]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
### - Southern X
]
.right-column[

```
data: southern-cross
layer:
    mapping: x = Hour, y = Counts
    geom: line
facet: Wday
```

```{r x-facet, fig.height = 6}
```

]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
### - Southern X
]
.right-column[

```{r x-more, echo = TRUE}
```

]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
### - Southern X
]
.right-column[

```
data: southern-cross-more
layer:
    mapping: x = Hour, y = Counts
    geom: line
facet: Wday
```

```{r x-more-p}
```

]

---

.left-column[
## More on pedestrian data
### - `ggplot2`
### - Southern X
]
.right-column[

```
data: southern-cross-more
layer:
    mapping: x = Hour, y = Counts
    geom: line
facet: Wday
coord: polar
```

```{r x-polar}
```

]
